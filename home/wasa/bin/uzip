#!/bin/bash

dir="${1%.*}"
dir="${dir%%.@(tar.|rar.|zip.)*}" # Catch most edge-cases
# Some sanity cheaking
if [[ ! -e "$1" ]]; then
  echo "Cannot find '"$1"'."
  return 1
fi

if [[ -z $(bsdtar tf "$1") ]]; then
  echo "The archive '"$1"' is empty."
  return 1
fi

# If archive has a single toplevel directory don't make a new directory.
# Tucos on #archlinux
if [[ $(bsdtar tf "$1" | sed -r 's@([^/]+)/(.*)@\1@' | uniq | wc -l) == 1 ]]; then
  bsdtar xvf "$1"
elif [[ -e "$dir" ]]; then
  echo "The directory '"$dir"' already exists."
  return 1
else
  mkdir "$dir"
  bsdtar xvf "$1" -C "$dir"
fi
