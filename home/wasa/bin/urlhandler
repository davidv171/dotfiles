#!/usr/bin/env python3
"""Simple URL handler based on domains"""

import argparse
import os
import subprocess
import sys
from urllib.parse import urlparse

BROWSER = 'firefox'
YOUTUBE_DOMAINS = ['youtube.com', 'youtu.be']
SUPPORTED_DOMAINS = YOUTUBE_DOMAINS + ['vimeo.com', 'soundcloud.com']

def contains_any(element, choices):
    """Checks whether the given element contains any of the choices"""
    return any(choice in element for choice in choices)

def play(url, seek=0):
    """Wraps youtube-dl and mpv"""
    output = subprocess.check_output(
        ['youtube-dl', '-e', '--user-agent', '', url],
        stderr=subprocess.STDOUT, universal_newlines=True).split('\n')
    title = output[0]

    command = ['mpv', '--title', title, '--cache=8192', url]
    subprocess.call(command)

def main():
    """main function"""
    parser = argparse.ArgumentParser()
    parser.add_argument('url')
    args = parser.parse_args()
    domain = urlparse(args.url).netloc
    if not domain:
        sys.exit("invalid URL specified")
    if contains_any(domain, SUPPORTED_DOMAINS):
        play(args.url)
    else:
        subprocess.call([BROWSER, args.url])

if __name__ == '__main__':
    main()
